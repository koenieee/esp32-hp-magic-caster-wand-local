# ESP32-S3 Specific Configuration
# This file is automatically merged when target is set to esp32s3

# Flash Configuration (8MB Flash)
CONFIG_ESPTOOLPY_FLASHSIZE_8MB=y
CONFIG_ESPTOOLPY_FLASHSIZE="8MB"

# PSRAM Configuration for Seeeduino XIAO ESP32S3 (8MB OCTAL PSRAM)
CONFIG_SPIRAM=y
CONFIG_SPIRAM_MODE_OCT=y
CONFIG_SPIRAM_TYPE_AUTO=y
CONFIG_SPIRAM_SPEED_80M=y
CONFIG_SPIRAM_BOOT_INIT=y
CONFIG_SPIRAM_USE_MALLOC=y
CONFIG_SPIRAM_MALLOC_ALWAYSINTERNAL=16384
CONFIG_SPIRAM_TRY_ALLOCATE_WIFI_LWIP=y

# Partition Table
CONFIG_PARTITION_TABLE_CUSTOM=y
CONFIG_PARTITION_TABLE_CUSTOM_FILENAME="partitions-s3.csv"

# External Antenna Configuration for Seeeduino XIAO ESP32S3
# With external antenna, use full RF calibration for best performance
CONFIG_ESP_PHY_RF_CAL_FULL=y
CONFIG_ESP_PHY_RF_CAL_PARTIAL=n
CONFIG_ESP_PHY_CALIBRATION_AND_DATA_STORAGE=y

# Bluetooth/WiFi Coexistence Settings
CONFIG_ESP_COEX_SW_COEXIST_ENABLE=y
CONFIG_ESP_WIFI_SW_COEXIST_PREFERENCE_BALANCE=y
CONFIG_ESP_COEX_EXTERNAL_COEXIST_ENABLE=n

# BLE Settings optimized for external antenna
CONFIG_BT_BLE_ENABLED=y
CONFIG_BT_NIMBLE_ENABLED=y
CONFIG_BT_NIMBLE_MAX_CONNECTIONS=1
CONFIG_BTDM_CTRL_BR_EDR_MAX_ACL_CONN_EFF=0
CONFIG_BTDM_CTRL_BLE_MAX_CONN_EFF=1
CONFIG_BT_CTRL_BLE_MAX_ACT=4
CONFIG_BT_CTRL_BLE_STATIC_ACL_TX_BUF_NB=6
CONFIG_BT_CTRL_BLE_MAX_CONN=1
CONFIG_BT_CTRL_PINNED_TO_CORE_0=y

# WiFi Settings optimized for BLE coexistence (balanced, not aggressive)
CONFIG_ESP_WIFI_IRAM_OPT=y
CONFIG_ESP_WIFI_RX_IRAM_OPT=y
CONFIG_ESP_WIFI_STATIC_RX_BUFFER_NUM=6
CONFIG_ESP_WIFI_DYNAMIC_RX_BUFFER_NUM=16
CONFIG_ESP_WIFI_TX_BUFFER_TYPE=1
CONFIG_ESP_WIFI_DYNAMIC_TX_BUFFER_NUM=16
CONFIG_ESP_PHY_REDUCE_TX_POWER=n
CONFIG_ESP_PHY_MAX_TX_POWER=17
CONFIG_ESP_WIFI_AMPDU_TX_ENABLED=n
CONFIG_ESP_WIFI_AMPDU_RX_ENABLED=n
CONFIG_ESP_WIFI_NVS_ENABLED=y

# Prioritize BLE over WiFi for wand stability
CONFIG_ESP_WIFI_SW_COEXIST_PREFERENCE_BT=y

# CPU and Power settings
CONFIG_ESP_DEFAULT_CPU_FREQ_MHZ_240=y
CONFIG_ESP_DEFAULT_CPU_FREQ_MHZ=240

# Power Management - keep radio powered for stability
CONFIG_PM_ENABLE=n
